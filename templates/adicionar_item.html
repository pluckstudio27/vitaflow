{% extends "base.html" %}

{% block title %}Adicionar Item - VitaFlow{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="fas fa-plus"></i> Adicionar Novo Item
            </h1>
            <a href="{{ url_for('listar_itens') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar à Lista
            </a>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle"></i> Informações do Item
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" id="item-form" class="needs-validation" novalidate enctype="multipart/form-data">
                    <div class="row">
                        <!-- Nome do Item -->
                        <div class="col-md-6 mb-3">
                            <label for="nome" class="form-label">
                                <i class="fas fa-tag"></i> Nome do Item *
                            </label>
                            <input type="text" class="form-control" id="nome" name="nome" required 
                                   placeholder="Ex: Seringa 10ml">
                            <div class="invalid-feedback">
                                Por favor, informe o nome do item.
                            </div>
                        </div>

                        <!-- Setor -->
                        <div class="col-md-6 mb-3">
                            <label for="setor" class="form-label">
                                <i class="fas fa-building"></i> Setor *
                            </label>
                            <select class="form-select" id="setor" name="setor" required>
                                <option value="">Selecione o setor</option>
                                <option value="enfermagem">
                                    <i class="fas fa-user-nurse"></i> Enfermagem
                                </option>
                                <option value="farmacia">
                                    <i class="fas fa-pills"></i> Farmácia
                                </option>
                                <option value="laboratorio">
                                    <i class="fas fa-flask"></i> Laboratório
                                </option>
                                <option value="centro_cirurgico">
                                    <i class="fas fa-procedures"></i> Centro Cirúrgico
                                </option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione o setor.
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Localização -->
                        <div class="col-md-6 mb-3">
                            <label for="localizacao" class="form-label">
                                <i class="fas fa-map-marker-alt"></i> Localização *
                            </label>
                            <select class="form-select" id="localizacao" name="localizacao" required>
                                <option value="">Selecione a localização</option>
                                <option value="almoxarifado">
                                    <i class="fas fa-warehouse"></i> Almoxarifado
                                </option>
                                <option value="farmacia">
                                    <i class="fas fa-pills"></i> Farmácia
                                </option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor, selecione a localização.
                            </div>
                        </div>

                        <!-- Quantidade -->
                        <div class="col-md-6 mb-3">
                            <label for="quantidade" class="form-label">
                                <i class="fas fa-sort-numeric-up"></i> Quantidade *
                            </label>
                            <input type="number" class="form-control" id="quantidade" name="quantidade" 
                                   min="0" step="1" required placeholder="Ex: 100">
                            <div class="invalid-feedback">
                                Por favor, informe a quantidade (número positivo).
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Data de Compra -->
                        <div class="col-md-6 mb-3">
                            <label for="data_compra" class="form-label">
                                <i class="fas fa-calendar-alt"></i> Data de Compra *
                            </label>
                            <input type="date" class="form-control" id="data_compra" name="data_compra" required>
                            <div class="invalid-feedback">
                                Por favor, informe a data de compra.
                            </div>
                        </div>

                        <!-- Data de Vencimento -->
                        <div class="col-md-6 mb-3">
                            <label for="data_vencimento" class="form-label">
                                <i class="fas fa-calendar-times"></i> Data de Vencimento
                            </label>
                            <input type="date" class="form-control" id="data_vencimento" name="data_vencimento">
                            <small class="form-text text-muted">
                                Deixe em branco se o item não possui data de vencimento.
                            </small>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Preço Unitário -->
                        <div class="col-md-6 mb-3">
                            <label for="preco_unitario" class="form-label">
                                <i class="fas fa-dollar-sign"></i> Preço Unitário (R$)
                            </label>
                            <input type="number" class="form-control" id="preco_unitario" name="preco_unitario" 
                                   min="0" step="0.01" placeholder="Ex: 2.50">
                            <small class="form-text text-muted">
                                Valor em reais (opcional).
                            </small>
                        </div>

                        <!-- Lote -->
                        <div class="col-md-6 mb-3">
                            <label for="lote" class="form-label">
                                <i class="fas fa-barcode"></i> Lote
                            </label>
                            <input type="text" class="form-control" id="lote" name="lote" 
                                   placeholder="Ex: LT2024001">
                            <small class="form-text text-muted">
                                Número do lote (opcional).
                            </small>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Fornecedor -->
                        <div class="col-md-12 mb-3">
                            <label for="fornecedor" class="form-label">
                                <i class="fas fa-truck"></i> Fornecedor
                            </label>
                            <input type="text" class="form-control" id="fornecedor" name="fornecedor" 
                                   placeholder="Ex: Distribuidora Médica ABC Ltda">
                            <small class="form-text text-muted">
                                Nome do fornecedor (opcional).
                            </small>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Foto do Item -->
                        <div class="col-md-12 mb-3">
                            <label for="foto" class="form-label">
                                <i class="fas fa-camera"></i> Foto do Item
                            </label>
                            <input type="file" class="form-control" id="foto" name="foto" 
                                   accept="image/png,image/jpg,image/jpeg,image/gif">
                            <small class="form-text text-muted">
                                Formatos aceitos: PNG, JPG, JPEG, GIF. Tamanho máximo: 16MB.
                            </small>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Descrição -->
                        <div class="col-md-12 mb-3">
                            <label for="descricao" class="form-label">
                                <i class="fas fa-align-left"></i> Descrição
                            </label>
                            <textarea class="form-control" id="descricao" name="descricao" rows="3" 
                                      maxlength="500" placeholder="Descrição detalhada do item (opcional)"></textarea>
                            <div class="d-flex justify-content-between">
                                <small class="form-text text-muted">
                                    Informações adicionais sobre o item.
                                </small>
                                <small id="desc-counter" class="text-muted">500 caracteres restantes</small>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo do Item -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Resumo</h6>
                        <p class="mb-0">
                            <strong>Campos obrigatórios:</strong> Nome, Setor, Localização, Quantidade e Data de Compra.<br>
                            <strong>Campos opcionais:</strong> Descrição, Data de Vencimento, Preço, Fornecedor e Lote.
                        </p>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('listar_itens') }}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Cancelar
                                </a>
                                <div>
                                    <button type="reset" class="btn btn-outline-warning me-2">
                                        <i class="fas fa-undo"></i> Limpar Formulário
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Salvar Item
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Dicas -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-lightbulb"></i> Dicas para Preenchimento
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-check-circle text-success"></i> Boas Práticas:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-primary"></i> Use nomes descritivos e padronizados</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> Sempre informe a data de vencimento quando aplicável</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> Mantenha o número do lote para rastreabilidade</li>
                            <li><i class="fas fa-arrow-right text-primary"></i> Registre o preço para controle de custos</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-exclamation-triangle text-warning"></i> Atenção:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-warning"></i> A data de compra não pode ser futura</li>
                            <li><i class="fas fa-arrow-right text-warning"></i> A data de vencimento deve ser posterior à compra</li>
                            <li><i class="fas fa-arrow-right text-warning"></i> Quantidade deve ser um número inteiro positivo</li>
                            <li><i class="fas fa-arrow-right text-warning"></i> Verifique o setor e localização corretos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Definir data máxima como hoje para data de compra
document.getElementById('data_compra').max = new Date().toISOString().split('T')[0];

// Validação adicional no envio do formulário
document.getElementById('item-form').addEventListener('submit', function(e) {
    const dataCompra = new Date(document.getElementById('data_compra').value);
    const dataVencimento = document.getElementById('data_vencimento').value;
    
    if (dataVencimento) {
        const dataVenc = new Date(dataVencimento);
        if (dataVenc <= dataCompra) {
            e.preventDefault();
            showAlert('A data de vencimento deve ser posterior à data de compra!', 'danger');
            return false;
        }
    }
    
    const quantidade = parseInt(document.getElementById('quantidade').value);
    if (quantidade < 0) {
        e.preventDefault();
        showAlert('A quantidade deve ser um número positivo!', 'danger');
        return false;
    }
});
</script>
{% endblock %}