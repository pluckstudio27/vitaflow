{% extends "base.html" %}

{% block title %}Saída de Itens - VitaFlow{% endblock %}

{% block content %}
<style>
    .page-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 50px 50px;
    }
    .setor-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        margin: 0.2rem;
    }
    .setor-enfermagem { background: #e3f2fd; color: #1976d2; }
    .setor-laboratorio { background: #f3e5f5; color: #7b1fa2; }
    .setor-centro_cirurgico { background: #e8f5e8; color: #388e3c; }
</style>

<!-- Page Header -->
<div class="page-header">
    <div class="container text-center">
        <h1><i class="fas fa-sign-out-alt me-3"></i>Saída de Itens</h1>
        <p class="lead mb-0">Farmácia → Setores</p>
    </div>
</div>

<div class="container mt-4">


        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-sign-out-alt me-2"></i>Formulário de Saída</h5>
                    </div>
                    <div class="card-body p-4">
                        {% if itens %}
                            <form method="POST">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="item_id" class="form-label"><i class="fas fa-box me-1"></i>Item</label>
                                        <select class="form-select" id="item_id" name="item_id" required onchange="updateItemInfo()">
                                            <option value="">Selecione um item...</option>
                                            {% for item in itens %}
                                                <option value="{{ item.id }}" 
                                                        data-quantidade="{{ item.quantidade }}"
                                                        data-nome="{{ item.nome }}"
                                                        data-setor="{{ item.setor }}"
                                                        data-lote="{{ item.lote or 'N/A' }}">
                                                    {{ item.nome }} - {{ item.setor }} ({{ item.quantidade }} unidades)
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="quantidade" class="form-label"><i class="fas fa-sort-numeric-up me-1"></i>Quantidade</label>
                                        <input type="number" class="form-control" id="quantidade" name="quantidade" min="1" required>
                                        <div class="form-text">Disponível: <span id="quantidade-disponivel">0</span> unidades</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="destino" class="form-label"><i class="fas fa-map-marker-alt me-1"></i>Setor de Destino</label>
                                        <select class="form-select" id="destino" name="destino" required>
                                            <option value="">Selecione o setor...</option>
                                            {% for setor in setores %}
                                                <option value="{{ setor }}">
                                                    {% if setor == 'enfermagem' %}
                                                        <i class="fas fa-user-nurse"></i> Enfermagem
                                                    {% elif setor == 'laboratorio' %}
                                                        <i class="fas fa-flask"></i> Laboratório
                                                    {% elif setor == 'centro_cirurgico' %}
                                                        <i class="fas fa-procedures"></i> Centro Cirúrgico
                                                    {% endif %}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="responsavel" class="form-label"><i class="fas fa-user me-1"></i>Responsável</label>
                                        <input type="text" class="form-control" id="responsavel" name="responsavel" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="motivo" class="form-label"><i class="fas fa-comment me-1"></i>Motivo da Saída</label>
                                    <input type="text" class="form-control" id="motivo" name="motivo" placeholder="Ex: Atendimento de emergência, cirurgia programada">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observacoes" class="form-label"><i class="fas fa-sticky-note me-1"></i>Observações</label>
                                    <textarea class="form-control" id="observacoes" name="observacoes" rows="3" placeholder="Observações adicionais (opcional)"></textarea>
                                </div>
                                
                                <!-- Info do Item Selecionado -->
                                <div id="item-info" class="alert alert-info" style="display: none;">
                                    <h6><i class="fas fa-info-circle me-2"></i>Informações do Item</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>Nome:</strong> <span id="info-nome">-</span>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Setor Original:</strong> <span id="info-setor">-</span>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Lote:</strong> <span id="info-lote">-</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Setores Disponíveis -->
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-hospital me-1"></i>Setores Disponíveis</label>
                                    <div>
                                        <span class="setor-badge setor-enfermagem">
                                            <i class="fas fa-user-nurse me-1"></i>Enfermagem
                                        </span>
                                        <span class="setor-badge setor-laboratorio">
                                            <i class="fas fa-flask me-1"></i>Laboratório
                                        </span>
                                        <span class="setor-badge setor-centro_cirurgico">
                                            <i class="fas fa-procedures me-1"></i>Centro Cirúrgico
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary me-md-2">
                                        <i class="fas fa-arrow-left me-1"></i>Voltar
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-sign-out-alt me-1"></i>Registrar Saída
                                    </button>
                                </div>
                            </form>
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Nenhum item disponível na farmácia</h5>
                                <p class="text-muted">Transfira itens do almoxarifado para a farmácia primeiro.</p>
                                <a href="{{ url_for('transferir_item') }}" class="btn btn-primary">
                                    <i class="fas fa-exchange-alt me-1"></i>Transferir Itens
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
</div>

<script>
    function updateItemInfo() {
        const select = document.getElementById('item_id');
        const option = select.options[select.selectedIndex];
        const quantidadeInput = document.getElementById('quantidade');
        const infoDiv = document.getElementById('item-info');
        
        if (option.value) {
            const quantidade = option.dataset.quantidade;
            const nome = option.dataset.nome;
            const setor = option.dataset.setor;
            const lote = option.dataset.lote;
            
            document.getElementById('quantidade-disponivel').textContent = quantidade;
            document.getElementById('info-nome').textContent = nome;
            document.getElementById('info-setor').textContent = setor;
            document.getElementById('info-lote').textContent = lote;
            
            quantidadeInput.max = quantidade;
            infoDiv.style.display = 'block';
        } else {
            document.getElementById('quantidade-disponivel').textContent = '0';
            quantidadeInput.max = '';
            infoDiv.style.display = 'none';
        }
    }
</script>

{% endblock %}